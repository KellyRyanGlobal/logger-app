pipeline {
    agent any
    
    stages {
        stage('Build') {
            agent { 
                dockerfile true               
            }
            environment {

                DOCKER_USER = credentials('docker-username')
                DOCKER_PASS = credentials('docker-password')
            }

            steps {
                sh '''
                make -C src
                chmod +x build.sh
                ./build.sh > output.out
                '''
            }
        }
        stage('Functional Test') {
            agent { 
                dockerfile true               
            }
            environment {

                DOCKER_USER = credentials('docker-username')
                DOCKER_PASS = credentials('docker-password')
            }
            steps {
                sh '''
                chmod +x build.sh
                ./build.sh > output.out
                chmod +x test/functional/functional.sh
                test/functional/functional.sh output.out
                '''
            }
        }
     }
}
